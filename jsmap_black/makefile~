GENERATED_FILES = \
	Entidades_2013.json

.PHONY: all clean

all: $(GENERATED_FILES)

clean:
	rm -rf -- $(GENERATED_FILES) build

build/mge2013v6_0.zip:
	mkdir -p $(dir $@)
	curl -o $@ 'http://mapserver.inegi.org.mx/MGN/mge2013v6_0.zip'

build/Entidades_2013.shp: build/mge2013v6_0.zip
	rm -rf -- $(basename $@)
	mkdir -p $(basename $@)
	unzip -d $(basename $@) $<
	for file in `find $(basename $@) -type f`; do chmod 644 $$file; mv $$file $(basename $@).$${file##*.}; done
	rm -rf -- $(basename $@)
	touch $@

Entidades_2013.json: build/Entidades_2013.shp
	node_modules/.bin/topojson --width=960 --margin=20 --simplify=1 -q 1e5 -o $@ -p name=NOM_MUN -p state=+CVE_ENT -- states=$<

